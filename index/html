<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todoãƒªã‚¹ãƒˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
    }
  }
  </script>

  <script type="module">
    import React, { useState, useEffect } from 'react';
    import ReactDOM from 'react-dom/client';

    // ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Trash2 = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const Edit2 = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
      </svg>
    );

    const Check = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    );

    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    // localStorageä»£æ›¿ï¼ˆwindow.storageã®ä»£ã‚ã‚Šï¼‰
    const storage = {
      get: (key) => {
        const data = localStorage.getItem(key);
        return data ? { value: data } : null;
      },
      set: (key, value) => {
        localStorage.setItem(key, value);
        return { key, value };
      }
    };

    function TodoApp() {
      const [todos, setTodos] = useState([]);
      const [input, setInput] = useState('');
      const [selectedImportance, setSelectedImportance] = useState('medium');
      const [editId, setEditId] = useState(null);
      const [editText, setEditText] = useState('');
      const [isLoading, setIsLoading] = useState(true);
      const [draggedTodo, setDraggedTodo] = useState(null);
      const [activeItem, setActiveItem] = useState(null);
      const [dragOverZone, setDragOverZone] = useState(null);
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

      useEffect(() => {
        const loadTodos = () => {
          try {
            const result = storage.get('todos');
            if (result) {
              setTodos(JSON.parse(result.value));
            }
          } catch (error) {
            console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
          } finally {
            setIsLoading(false);
          }
        };
        loadTodos();
      }, []);

      useEffect(() => {
        if (!isLoading) {
          try {
            storage.set('todos', JSON.stringify(todos));
          } catch (error) {
            console.error('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
          }
        }
      }, [todos, isLoading]);

      const addTodo = () => {
        if (input.trim()) {
          const priorityMap = { 'high': 'high', 'medium': 'medium', 'low': 'low' };
          setTodos([...todos, { 
            id: Date.now(), 
            text: input, 
            completed: false, 
            priority: priorityMap[selectedImportance], 
            importance: selectedImportance 
          }]);
          setInput('');
          setSelectedImportance('medium');
        }
      };

      const deleteTodo = (id) => setTodos(todos.filter(todo => todo.id !== id));

      const startEdit = (id, text) => {
        setEditId(id);
        setEditText(text);
      };

      const saveEdit = () => {
        setTodos(todos.map(todo => 
          todo.id === editId ? { ...todo, text: editText } : todo
        ));
        setEditId(null);
        setEditText('');
      };

      const cancelEdit = () => {
        setEditId(null);
        setEditText('');
      };

      const toggleComplete = (id) => {
        setTodos(todos.map(todo =>
          todo.id === id ? { 
            ...todo, 
            completed: !todo.completed, 
            importance: todo.completed ? (todo.importance || 'medium') : 'completed' 
          } : todo
        ));
      };

      const deleteCompleted = (e) => {
        if (e) {
          e.preventDefault();
          e.stopPropagation();
        }
        setShowDeleteConfirm(true);
      };

      const confirmDeleteCompleted = () => {
        setTodos(todos.filter(todo => !todo.completed));
        setShowDeleteConfirm(false);
      };

      const cancelDelete = () => setShowDeleteConfirm(false);

      const changePriority = (id) => {
        setTodos(todos.map(todo => {
          if (todo.id === id) {
            const priorities = ['low', 'medium', 'high'];
            const currentIndex = priorities.indexOf(todo.priority || 'medium');
            const nextIndex = (currentIndex + 1) % priorities.length;
            return { ...todo, priority: priorities[nextIndex] };
          }
          return todo;
        }));
      };

      const getPriorityColor = (priority, isActive) => {
        const baseClasses = 'border-l-4';
        if (isActive) {
          switch(priority) {
            case 'high': return `bg-red-100 ${baseClasses} border-red-600`;
            case 'medium': return `bg-yellow-100 ${baseClasses} border-yellow-600`;
            case 'low': return `bg-green-100 ${baseClasses} border-green-600`;
            default: return `bg-gray-100 ${baseClasses} border-gray-600`;
          }
        }
        switch(priority) {
          case 'high': return `bg-red-50 ${baseClasses} border-red-500`;
          case 'medium': return `bg-yellow-50 ${baseClasses} border-yellow-500`;
          case 'low': return `bg-green-50 ${baseClasses} border-green-500`;
          default: return 'bg-gray-50';
        }
      };

      const getPriorityButton = (priority) => {
        switch(priority) {
          case 'high': return { emoji: 'ðŸ”´', label: 'é«˜', color: 'bg-red-100 hover:bg-red-200 text-red-700' };
          case 'medium': return { emoji: 'ðŸŸ¡', label: 'ä¸­', color: 'bg-yellow-100 hover:bg-yellow-200 text-yellow-700' };
          case 'low': return { emoji: 'ðŸŸ¢', label: 'ä½Ž', color: 'bg-green-100 hover:bg-green-200 text-green-700' };
          default: return { emoji: 'ðŸŸ¡', label: 'ä¸­', color: 'bg-yellow-100 hover:bg-yellow-200 text-yellow-700' };
        }
      };

      const getDifficultyZoneStyle = (importance) => {
        switch(importance) {
          case 'high': return 'bg-red-100 border-red-400';
          case 'medium': return 'bg-yellow-100 border-yellow-400';
          case 'low': return 'bg-green-100 border-green-400';
          case 'completed': return 'bg-slate-100 border-slate-400';
          default: return 'bg-gray-50 border-gray-300';
        }
      };

      const getDifficultyZoneTitle = (importance) => {
        switch(importance) {
          case 'high': return { label: 'å„ªå…ˆåº¦ï¼šé«˜' };
          case 'medium': return { label: 'å„ªå…ˆåº¦ï¼šä¸­' };
          case 'low': return { label: 'å„ªå…ˆåº¦ï¼šä½Ž' };
          case 'completed': return { label: 'å®Œäº†' };
          default: return { label: 'å„ªå…ˆåº¦ï¼šä¸­' };
        }
      };

      const handleDragStart = (e, todo) => {
        setDraggedTodo(todo);
        setActiveItem(todo.id);
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleDragEnd = () => {
        setDraggedTodo(null);
        setDragOverZone(null);
        setTimeout(() => setActiveItem(null), 200);
      };

      const handleZoneDragOver = (e, importance) => {
        e.preventDefault();
        setDragOverZone(importance);
      };

      const handleZoneDragLeave = () => setDragOverZone(null);

      const handleZoneDrop = (e, importance) => {
        e.preventDefault();
        if (draggedTodo) {
          setTodos(todos.map(todo =>
            todo.id === draggedTodo.id ? { ...todo, importance } : todo
          ));
        }
        setDragOverZone(null);
      };

      const handleMouseDown = (id) => setActiveItem(id);
      const handleMouseUp = () => setTimeout(() => setActiveItem(null), 150);

      const getTodosByDifficulty = (importance) => {
        return todos.filter(todo => (todo.importance || 'medium') === importance);
      };

      return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4' },
        showDeleteConfirm && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50' },
          React.createElement('div', { className: 'bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl' },
            React.createElement('h3', { className: 'text-lg font-bold mb-4' }, 'ç¢ºèª'),
            React.createElement('p', { className: 'text-gray-700 mb-6' },
              `å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯${todos.filter(t => t.completed).length}ä»¶ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`
            ),
            React.createElement('div', { className: 'flex gap-3 justify-end' },
              React.createElement('button', {
                onClick: cancelDelete,
                className: 'px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors'
              }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'),
              React.createElement('button', {
                onClick: confirmDeleteCompleted,
                className: 'px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors'
              }, 'å‰Šé™¤')
            )
          )
        ),
        React.createElement('div', { className: 'max-w-6xl mx-auto' },
          React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-8 mb-6' },
            React.createElement('h1', { className: 'text-3xl font-bold text-gray-800 mb-2 text-center' }, 'Todoãƒªã‚¹ãƒˆ'),
            React.createElement('p', { className: 'text-sm text-gray-500 mb-6 text-center' },
              'ã‚¿ã‚¹ã‚¯ã‚’å„ªå…ˆåº¦ã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦æ•´ç†ã§ãã¾ã™'
            ),
            React.createElement('div', { className: 'flex flex-col sm:flex-row gap-2 mb-6' },
              React.createElement('input', {
                type: 'text',
                value: input,
                onChange: (e) => setInput(e.target.value),
                onKeyPress: (e) => e.key === 'Enter' && addTodo(),
                placeholder: 'æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›...',
                className: 'flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent'
              }),
              React.createElement('div', { className: 'flex gap-2' },
                React.createElement('select', {
                  value: selectedImportance,
                  onChange: (e) => setSelectedImportance(e.target.value),
                  className: 'flex-1 sm:flex-none px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white'
                },
                  React.createElement('option', { value: 'low' }, 'å„ªå…ˆåº¦ï¼šä½Ž'),
                  React.createElement('option', { value: 'medium' }, 'å„ªå…ˆåº¦ï¼šä¸­'),
                  React.createElement('option', { value: 'high' }, 'å„ªå…ˆåº¦ï¼šé«˜')
                ),
                React.createElement('button', {
                  onClick: addTodo,
                  className: 'bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors whitespace-nowrap'
                },
                  React.createElement(Plus, { size: 20 }),
                  'è¿½åŠ '
                )
              )
            ),
            todos.length > 0 && React.createElement('div', { className: 'pt-6 border-t border-gray-200 text-center text-gray-600' },
              `åˆè¨ˆ: ${todos.length}ä»¶ | å®Œäº†: ${todos.filter(t => t.completed).length}ä»¶`
            )
          ),
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4' },
            ['low', 'medium', 'high', 'completed'].map(importance =>
              React.createElement('div', {
                key: importance,
                onDragOver: (e) => handleZoneDragOver(e, importance),
                onDragLeave: handleZoneDragLeave,
                onDrop: (e) => handleZoneDrop(e, importance),
                className: `${getDifficultyZoneStyle(importance)} border-2 rounded-xl p-4 min-h-[400px] transition-all ${
                  dragOverZone === importance ? 'border-dashed border-4 scale-105 shadow-lg' : ''
                }`
              },
                React.createElement('h2', { className: 'text-lg font-bold mb-4 flex items-center gap-2' },
                  React.createElement('span', null, getDifficultyZoneTitle(importance).label),
                  React.createElement('span', { className: 'text-sm font-normal text-gray-500' },
                    `(${getTodosByDifficulty(importance).length})`
                  ),
                  importance === 'completed' && getTodosByDifficulty(importance).length > 0 &&
                    React.createElement('button', {
                      onClick: deleteCompleted,
                      type: 'button',
                      className: 'ml-auto text-xs bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-full transition-colors'
                    }, 'ä¸€æ‹¬å‰Šé™¤')
                ),
                React.createElement('div', { className: 'space-y-2' },
                  isLoading ? React.createElement('p', { className: 'text-center text-gray-400 py-8' }, 'èª­ã¿è¾¼ã¿ä¸­...') :
                  getTodosByDifficulty(importance).length === 0 ?
                    React.createElement('p', { className: 'text-center text-gray-400 py-8 text-sm' }, 'ã‚¿ã‚¹ã‚¯ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—') :
                    getTodosByDifficulty(importance).map(todo =>
                      React.createElement('div', {
                        key: todo.id,
                        draggable: true,
                        onDragStart: (e) => handleDragStart(e, todo),
                        onDragEnd: handleDragEnd,
                        onMouseDown: () => handleMouseDown(todo.id),
                        onMouseUp: handleMouseUp,
                        className: `${getPriorityColor(todo.priority, activeItem === todo.id)} rounded-lg p-3 flex items-center gap-2 transition-all cursor-move ${
                          draggedTodo?.id === todo.id ? 'opacity-50 scale-105' : ''
                        } ${activeItem === todo.id ? 'shadow-lg scale-102' : 'hover:opacity-90'}`
                      },
                        React.createElement('input', {
                          type: 'checkbox',
                          checked: todo.completed,
                          onChange: () => toggleComplete(todo.id),
                          className: 'w-4 h-4 rounded cursor-pointer flex-shrink-0'
                        }),
                        editId === todo.id ?
                          React.createElement('input', {
                            type: 'text',
                            value: editText,
                            onChange: (e) => setEditText(e.target.value),
                            onKeyPress: (e) => e.key === 'Enter' && saveEdit(),
                            className: 'flex-1 px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm',
                            autoFocus: true
                          }) :
                          React.createElement('span', {
                            className: `flex-1 text-sm ${todo.completed ? 'line-through text-gray-400' : 'text-gray-800'}`
                          }, todo.text),
                        importance !== 'completed' && React.createElement('button', {
                          onClick: () => changePriority(todo.id),
                          className: `px-2 py-1 rounded-full text-xs font-medium transition-colors flex-shrink-0 ${getPriorityButton(todo.priority || 'medium').color}`,
                          title: 'ã‚¯ãƒªãƒƒã‚¯ã§é‡è¦åº¦ã‚’å¤‰æ›´'
                        }, getPriorityButton(todo.priority || 'medium').emoji),
                        React.createElement('div', { className: 'flex gap-1 flex-shrink-0' },
                          editId === todo.id ? [
                            React.createElement('button', {
                              key: 'save',
                              onClick: saveEdit,
                              className: 'text-green-600 hover:text-green-700 p-1',
                              title: 'ä¿å­˜'
                            }, React.createElement(Check, { size: 16 })),
                            React.createElement('button', {
                              key: 'cancel',
                              onClick: cancelEdit,
                              className: 'text-gray-600 hover:text-gray-700 p-1',
                              title: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'
                            }, React.createElement(X, { size: 16 }))
                          ] : [
                            React.createElement('button', {
                              key: 'edit',
                              onClick: () => startEdit(todo.id, todo.text),
                              className: 'text-blue-600 hover:text-blue-700 p-1',
                              title: 'ç·¨é›†'
                            }, React.createElement(Edit2, { size: 16 })),
                            React.createElement('button', {
                              key: 'delete',
                              onClick: () => deleteTodo(todo.id),
                              className: 'text-red-600 hover:text-red-700 p-1',
                              title: 'å‰Šé™¤'
                            }, React.createElement(Trash2, { size: 16 }))
                          ]
                        )
                      )
                    )
                )
              )
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(TodoApp));
  </script>
</body>
</html>
